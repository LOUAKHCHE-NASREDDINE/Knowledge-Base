

# **Guide Backup Jenkins: 
## Why Backup Jenkins?
Jenkins is a crucial part of your CI/CD pipeline, containing jobs, builds, user configurations, plugins, and system settings. Backing up Jenkins allows you to recover from unexpected data loss, server failures, or to migrate Jenkins to a different machine.

### **What to Backup in Jenkins?**
- **Job Configurations**: All your Jenkins jobs and pipelines.
- **Plugins and Plugin Configurations**: Installed plugins and their settings.
- **User Settings**: User accounts and permissions.
- **System Configuration**: Global settings for Jenkins.
- **Build Artifacts**: Artifacts generated by job builds (optional).
- **Secrets and Credentials**: API tokens, credentials, and secrets (optional).

### **Jenkins Home Directory**
Jenkins stores all its data, including job configurations, plugins, and system settings, in the **JENKINS_HOME** directory. By default, this is located at `/var/jenkins_home`.

---

## **Step 1: Identify the Jenkins Home Directory**
You need to identify the directory where Jenkins stores all its configurations and job data. 

1. Open the Jenkins web interface.
2. Go to **Manage Jenkins** → **System Information**.
3. Look for the `JENKINS_HOME` variable. By default, it is located at `/var/jenkins_home` on Linux systems.

Alternatively, you can check it on the Jenkins server:
```bash
echo $JENKINS_HOME
```

---

## **Step 2: Backup Jenkins Files Manually**

### Option 1: **Create a Full Backup Using Tar**
This is the most straightforward method to back up all Jenkins files and configurations. You will archive the entire Jenkins home directory.

1. **Stop the Jenkins service** (to ensure all files are properly saved before the backup).
   ```bash
   sudo systemctl stop jenkins
   ```

2. **Create a tarball of the Jenkins home directory**:
   ```bash
   sudo tar -cvpzf jenkins-backup-$(date +%F).tar.gz /var/jenkins_home
   ```

3. **Restart the Jenkins service**:
   ```bash
   sudo systemctl start jenkins
   ```

This will create a `tar.gz` archive containing all Jenkins files, configurations, and job data.

### Option 2: **Copy Key Directories**
If you want to back up specific parts of Jenkins, you can selectively copy important directories:

- **Jobs**: `/var/jenkins_home/jobs/` (contains all job configurations).
- **Plugins**: `/var/jenkins_home/plugins/` (installed plugins).
- **Users**: `/var/jenkins_home/users/` (user configurations).
- **Credentials**: `/var/jenkins_home/credentials.xml` (sensitive credentials).
- **Global Configurations**: `/var/jenkins_home/config.xml` (Jenkins global configuration).

Example:
```bash
sudo cp -r /var/jenkins_home/jobs/ /backup/jenkins/jobs/
sudo cp -r /var/jenkins_home/plugins/ /backup/jenkins/plugins/
```

---

## **Step 3: Backup Jenkins Using a Plugin**

Jenkins provides plugins that help automate the backup process.

### **Backup Plugin**

1. **Install the Backup Plugin**:
   - Go to **Manage Jenkins** → **Manage Plugins** → **Available**.
   - Search for "ThinBackup".
   - Click **Install** and restart Jenkins if prompted.

2. **Configure the Backup Plugin**:
   - Go to **Manage Jenkins** → **ThinBackup**.
   - Set the backup directory (where backups will be stored).
   - Configure the backup schedule (using cron syntax) to automate backups.
   - Choose what to include in the backup (job configurations, build records, user configurations, etc.).

3. **Start a Backup**:
   - To create a manual backup, go to **ThinBackup** and select **Backup Now**.

4. **Automated Backups**:
   - The plugin will automatically create backups based on the schedule you configure.

---

## **Step 4: Backup Jenkins to the Cloud (Optional)**

### **AWS S3 Backup** (for those using cloud storage)
You can configure Jenkins backups to be uploaded to AWS S3 for offsite storage.

1. **Install AWS CLI**:
   ```bash
   sudo apt-get install awscli
   ```

2. **Configure AWS CLI**:
   ```bash
   aws configure
   ```

3. **Sync Jenkins Backup to S3**:
   After creating a backup, you can sync the backup file to an S3 bucket.
   ```bash
   aws s3 cp /backup/jenkins-backup.tar.gz s3://my-jenkins-backups/
   ```

### **Google Cloud Storage Backup**
Alternatively, you can use `gsutil` for Google Cloud.

1. **Install `gsutil`**:
   ```bash
   sudo apt-get install google-cloud-sdk
   ```

2. **Upload Backup**:
   ```bash
   gsutil cp /backup/jenkins-backup.tar.gz gs://my-jenkins-backups/
   ```

---

## **Step 5: Automating Backups with Cron**

To automate Jenkins backups, you can set up a cron job to run the backup command at regular intervals.

1. **Open the crontab editor**:
   ```bash
   crontab -e
   ```

2. **Add a cron job**:
   This example will create a backup every day at 2 AM:
   ```bash
   0 2 * * * sudo tar -cvpzf /backup/jenkins-backup-$(date +\%F).tar.gz /var/jenkins_home
   ```

3. **Save and close the crontab**.

---

## **Step 6: Restore Jenkins from Backup**

If you need to restore Jenkins from a backup, follow these steps:

1. **Stop the Jenkins service**:
   ```bash
   sudo systemctl stop jenkins
   ```

2. **Extract the backup**:
   ```bash
   sudo tar -xvpzf /path/to/jenkins-backup.tar.gz -C /
   ```

3. **Restart Jenkins**:
   ```bash
   sudo systemctl start jenkins
   ```

Your Jenkins should now be restored to the state captured in the backup.

